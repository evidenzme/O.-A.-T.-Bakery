<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>O. A. T. Company LTD — Prototype</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --blue: #003399;
        --red: #d60000;
        --yellow: #ffcc00;
        --muted: #6b7280;
        --bg: #fff;
        --max-width: 1200px;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: "Poppins", system-ui, -apple-system, Segoe UI, Roboto,
          Arial;
        color: #111;
        background: var(--bg);
      }
      header.site-header {
        position: fixed;
        inset: 0 0 auto 0;
        z-index: 60;
        width: 100%;
        display: flex;
        justify-content: center;
        pointer-events: none;
      }
      .site-header .inner {
        pointer-events: auto;
        width: 100%;
        max-width: var(--max-width);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 18px 22px;
        transition: 300ms ease, box-shadow 300ms ease;
        background: transparent;
        border-radius: 10px;
      }
      .site-header.solid .inner {
        background: rgba(255, 255, 255, 0.98);
        box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
        padding: 10px 22px;
      }
      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .brand img {
        height: 48px;
        width: auto;
        display: block;
        border-radius: 6px;
      }
      .brand h1 {
        font-size: 1.05rem;
        margin: 0;
        color: var(--blue);
        font-weight: 700;
      }
      nav.primary {
        display: flex;
        gap: 14px;
        align-items: center;
      }
      nav.primary a {
        color: var(--blue);
        text-decoration: none;
        font-weight: 600;
      }
      nav.primary a.cta {
        background: var(--red);
        color: #fff;
        padding: 10px 14px;
        border-radius: 8px;
      }

      .hero {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        position: relative;
        padding: 0 24px;
        overflow: hidden;
      }
      .hero .bg {
        position: absolute;
        inset: 0;
        z-index: 0;
        background-image: url("");
        background-size: cover;
        background-position: center;
        filter: brightness(0.9) saturate(0.95);
        transform: scale(1.02);
      }
      .hero .overlay {
        position: absolute;
        inset: 0;
        z-index: 1;
        background: linear-gradient(
          90deg,
          rgba(0, 23, 77, 0.62) 0%,
          rgba(0, 23, 77, 0.28) 45%,
          rgba(0, 0, 0, 0.12) 100%
        );
        mix-blend-mode: multiply;
      }
      .hero .content {
        position: relative;
        z-index: 2;
        max-width: 720px;
        margin-left: 8vw;
        color: #fff;
      }
      .hero h2 {
        margin: 0 0 18px 0;
        font-size: 3.6rem;
        line-height: 1.02;
        letter-spacing: -1px;
        color: var(--blue);
        text-shadow: 0 8px 30px rgba(0, 0, 0, 0.45);
      }
      .hero p.lead {
        margin: 0 0 24px 0;
        font-size: 1.15rem;
        color: rgba(255, 255, 255, 0.92);
        max-width: 520px;
      }
      .hero .actions {
        display: flex;
        gap: 14px;
        align-items: center;
      }
      .btn {
        display: inline-block;
        padding: 12px 20px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 700;
      }
      .btn.primary {
        background: var(--red);
        color: #fff;
      }
      .btn.ghost {
        background: transparent;
        border: 2px solid rgba(255, 255, 255, 0.15);
        color: #fff;
      }

      .hero-visual {
        position: absolute;
        right: 6vw;
        bottom: 6vh;
        width: 420px;
        max-width: 40%;
        z-index: 2;
        transform: translateY(0);
        filter: drop-shadow(0 24px 40px rgba(0, 0, 0, 0.45));
      }
      .hero-visual img {
        width: 100%;
        border-radius: 18px;
        display: block;
      }

      .info-strip {
        max-width: var(--max-width);
        margin: -40px auto 20px;
        padding: 22px;
        display: flex;
        gap: 18px;
        align-items: center;
        justify-content: space-between;
        background: linear-gradient(
          90deg,
          rgba(0, 51, 153, 0.03),
          rgba(214, 0, 0, 0.02)
        );
        border-radius: 12px;
      }
      .info-left {
        font-size: 0.98rem;
      }
      .info-right {
        font-size: 0.95rem;
        color: var(--muted);
      }

      footer.site-footer {
        background: var(--blue);
        color: #fff;
        padding: 26px 22px;
        margin-top: 40px;
        display: flex;
        justify-content: center;
      }
      footer .inner {
        max-width: var(--max-width);
        width: 100%;
        display: flex;
        justify-content: space-between;
        gap: 20px;
        align-items: center;
      }

      /* Menu modal */
      #menuModal {
        position: fixed;
        inset: 0;
        z-index: 120;
        display: none;
        align-items: center;
        justify-content: center;
        background: linear-gradient(rgba(0, 0, 0, 0.35), rgba(0, 0, 0, 0.45));
        padding: 28px;
      }
      #menuModal .modal {
        width: 100%;
        max-width: 980px;
        background: #fff;
        border-radius: 14px;
        padding: 22px;
        box-shadow: 0 30px 60px rgba(2, 6, 23, 0.35);
        transform: translateY(16px);
        opacity: 0;
        transition: all 0.42s cubic-bezier(0.2, 0.9, 0.3, 1);
      }
      #menuModal.show .modal {
        transform: none;
        opacity: 1;
      }
      .modal header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 12px;
      }
      .modal header h3 {
        margin: 0;
        font-size: 1.25rem;
        color: var(--blue);
      }
      .modal .close-btn {
        background: transparent;
        border: 0;
        font-weight: 700;
        color: var(--muted);
        cursor: pointer;
      }

      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 18px;
        margin-top: 12px;
      }
      .card {
        background: linear-gradient(180deg, #fff, #fff);
        border-radius: 12px;
        padding: 12px;
        text-align: center;
        border: 1px solid rgba(15, 23, 42, 0.04);
        display: flex;
        flex-direction: column;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
        transition: transform 0.25s ease, box-shadow 0.25s ease;
      }
      .card:hover {
        transform: translateY(-6px);
        box-shadow: 0 18px 40px rgba(8, 15, 30, 0.08);
      }
      .card img {
        width: 100%;
        height: 160px;
        object-fit: cover;
        border-radius: 10px;
        border: 4px solid var(--yellow);
      }
      .card h4 {
        margin: 0;
        font-size: 1rem;
        color: #111;
      }
      .card p {
        margin: 0;
        font-size: 0.9rem;
        color: var(--muted);
      }
      .card .price-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
        margin-top: 8px;
      }
      .price-pill {
        background: linear-gradient(180deg, #fff, #fff);
        border: 1px solid rgba(0, 0, 0, 0.06);
        padding: 6px 10px;
        border-radius: 999px;
        font-weight: 700;
        cursor: pointer;
      }
      .price-pill.disabled {
        opacity: 0.35;
        cursor: not-allowed;
      }
      .availability {
        margin-top: 8px;
        font-weight: 700;
      }
      .badge-available {
        color: green;
      }
      .badge-out {
        color: #c0392b;
      }
      .card .card-actions {
        display: flex;
        gap: 8px;
        margin-top: 8px;
      }
      .card .order-btn {
        background: var(--red);
        color: #fff;
        padding: 8px 12px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 700;
      }

      /* Right-side cart drawer */
      .cart-drawer {
        position: fixed;
        right: 20px;
        top: 90px;
        z-index: 140;
        width: 360px;
        max-width: calc(100% - 48px);
        height: 70vh;
        background: #fff;
        border-radius: 12px;
        padding: 12px;
        box-shadow: 0 30px 80px rgba(2, 6, 23, 0.2);
        transform: translateX(110%);
        transition: transform 0.36s cubic-bezier(0.2, 0.9, 0.3, 1);
        display: flex;
        flex-direction: column;
      }
      .cart-drawer.open {
        transform: translateX(0);
      }
      .cart-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .cart-list {
        overflow: auto;
        flex: 1;
        margin-top: 10px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding-right: 6px;
      }
      .cart-item {
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px dashed rgba(0, 0, 0, 0.04);
        padding-bottom: 8px;
      }
      .qty-controls {
        display: flex;
        gap: 6px;
        align-items: center;
      }
      .small-btn {
        background: #f3f4f6;
        border: 0;
        padding: 6px 8px;
        border-radius: 6px;
        cursor: pointer;
      }
      .total-row {
        display: flex;
        justify-content: space-between;
        margin-top: 12px;
        font-weight: 800;
      }
      .checkout {
        margin-top: 12px;
        background: var(--red);
        color: #fff;
        padding: 10px;
        border-radius: 10px;
        border: 0;
        width: 100%;
        font-weight: 800;
        cursor: pointer;
      }

      /* Minimized cart button */
      .cart-min-btn {
        position: fixed;
        right: 22px;
        bottom: 110px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: var(--blue);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 30px rgba(0, 51, 153, 0.18);
        cursor: pointer;
        z-index: 150;
      }
      .cart-count {
        position: absolute;
        top: -6px;
        right: -6px;
        background: var(--red);
        color: #fff;
        width: 22px;
        height: 22px;
        border-radius: 999px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        font-size: 12px;
        border: 3px solid #fff;
      }

      .whatsapp-cta {
        position: fixed;
        right: 22px;
        bottom: 22px;
        z-index: 130;
        width: 62px;
        height: 62px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(180deg, #26d66b, #07a857);
        box-shadow: 0 10px 30px rgba(37, 214, 102, 0.18),
          0 0 40px rgba(37, 214, 102, 0.12);
        cursor: pointer;
      }

      @media (max-width: 880px) {
        .hero h2 {
          font-size: 2.4rem;
        }
        .hero-visual {
          display: none;
        }
        .cart-drawer {
          right: 8px;
          left: 8px;
          width: auto;
          height: 60vh;
        }
        .cart-min-btn {
          right: 16px;
          bottom: 100px;
        }
      }
    </style>
  </head>
  <body>
    <header class="site-header" role="banner">
      <div class="inner" id="siteHeaderInner">
        <div class="brand">
          <img src="/assets/logo.jpg" alt="O. A. T. Company LTD logo" />
          <div>
            <h1>O. A. T. Company LTD</h1>
            <div
              style="font-size: 0.78rem; color: var(--muted); margin-top: 4px"
            >
              Adjacent KAWSEC (Nkawkaw SHS) Junction
            </div>
          </div>
        </div>
        <nav class="primary" aria-label="Primary navigation">
          <a href="#home" class="nav-link">Home</a>
          <a href="#" id="openMenu" class="nav-link">Menu</a>
          <a href="#about" class="nav-link">About</a>
          <a href="#contact" class="nav-link">Contact</a>
          <a
            href="https://wa.me/233507969291"
            class="cta"
            style="margin-left: 6px"
            >Order on WhatsApp</a
          >
        </nav>
      </div>
    </header>

    <main id="home">
      <section class="hero">
        <div class="bg" aria-hidden="true"></div>
        <div class="overlay" aria-hidden="true"></div>
        <div class="content" id="heroContent">
          <h2>Freshly baked<br />every morning</h2>
          <p class="lead">
            Trusted by Nkawkaw for over a decade · Quality bread, hygienically
            prepared daily
          </p>
          <div class="actions">
            <a class="btn primary" id="viewMenuBtn" href="#">View Menu</a>
            <a class="btn ghost" href="https://wa.me/233507969291"
              >Order on WhatsApp</a
            >
          </div>
          <div
            style="
              margin-top: 18px;
              color: rgba(255, 255, 255, 0.88);
              font-size: 0.95rem;
            "
          >
            <strong>Hours:</strong> Mon–Sat: 5:00 AM – 7:00 PM &nbsp;|&nbsp;
            Sun: 5:30 AM – 6:00 PM
          </div>
        </div>
        <div class="hero-visual">
          <img src="/assets/fbl.webp" alt="Fresh bread loaves" />
        </div>
      </section>

      <div class="info-strip" id="about">
        <div class="info-left">
          <strong>O. A. T. Company LTD</strong><br />Family-owned bakery serving
          Nkawkaw — quality you can trust.
        </div>
        <div class="info-right">
          Adjacent KAWSEC (Nkawkaw Senior High School) Junction
        </div>
      </div>

      <section
        style="
          max-width: var(--max-width);
          margin: 20px auto;
          padding: 28px;
          text-align: center;
        "
      >
        <h3>Sample prototype content</h3>
        <p style="color: var(--muted); max-width: 820px; margin: 12px auto">
          This prototype includes clickable price variants, a manual
          availability badge, and a lightweight cart that accumulates items
          until you complete the order via WhatsApp.
        </p>
      </section>
    </main>

    <!-- Menu Modal -->
    <div id="menuModal" aria-modal="true" role="dialog" aria-hidden="true">
      <div class="modal" role="document">
        <header>
          <h3 id="menuTitle">Our Products</h3>
          <div>
            <button class="close-btn" id="closeMenu" aria-label="Close menu">
              ✕ Close
            </button>
          </div>
        </header>

        <div
          style="
            display: flex;
            gap: 12px;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
          "
        >
          <div style="font-size: 0.95rem; color: var(--muted)">
            Choose a price variant to add to cart. You may also order by total
            cost (Bulk-by-cost) — the system will compute units using our
            formula with r = 0.4.
          </div>
          <div style="display: flex; gap: 8px; align-items: center">
            <label style="font-size: 0.95rem; color: var(--muted)"
              >Order mode:</label
            >
            <select
              id="orderMode"
              style="
                padding: 8px;
                border-radius: 6px;
                border: 1px solid #e5e7eb;
              "
            >
              <option value="unit">By units (default)</option>
              <option value="cost">Bulk-by-cost (enter total GH₵)</option>
            </select>
          </div>
        </div>

        <div class="products-grid" id="productsGrid"></div>

        <div
          style="
            margin-top: 18px;
            text-align: center;
            color: var(--muted);
            font-size: 0.95rem;
          "
        >
          Pickup & Delivery available. We accept Mobile Money, Card on delivery,
          and Cash.
        </div>
      </div>
    </div>

    <!-- Right-side Cart Drawer (hidden until first item) -->
    <div class="cart-drawer" id="cartDrawer" aria-hidden="true">
      <div class="cart-header">
        <div>
          <strong>Your Cart</strong><br />
          <small style="color: var(--muted)"
            >Items saved locally. Complete order on WhatsApp.</small
          >
        </div>
        <div>
          <button id="minimizeCart" class="small-btn" title="Minimize">
            _
          </button>
          <button id="clearCart" class="small-btn" title="Clear cart">
            Clear
          </button>
        </div>
      </div>
      <div class="cart-list" id="cartList"></div>
      <div class="total-row">
        <div>Subtotal</div>
        <div id="cartSubtotal">GH₵ 0.00</div>
      </div>
      <button class="checkout" id="checkoutBtn">
        Complete order on WhatsApp
      </button>
    </div>

    <!-- Minimized cart button (hidden initially) -->
    <div
      class="cart-min-btn"
      id="cartMinBtn"
      style="display: none"
      title="Open cart"
    >
      <div style="position: relative">
        🧺<span class="cart-count" id="cartCount">0</span>
      </div>
    </div>

    <!-- Floating WhatsApp CTA -->
    <a
      class="whatsapp-cta"
      href="https://wa.me/233507969291"
      id="waCta"
      aria-label="Order on WhatsApp"
      ><svg
        width="28"
        height="28"
        viewBox="0 0 24 24"
        fill="none"
        aria-hidden="true"
        focusable="false"
      >
        <path
          d="M20.52 3.48a11.95 11.95 0 0 0-16.95 0c-4.68 4.68-4.67 12.27.02 16.95L2 22l1.6-2.08A11.95 11.95 0 0 0 20.52 3.48z"
          fill="#fff"
          opacity="0.06"
        />
        <path
          d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.1-.472-.149-.672.15-.2.297-.772.967-.946 1.165-.174.199-.347.224-.644.075-.297-.149-1.255-.462-2.39-1.48-.884-.788-1.48-1.761-1.654-2.059-.174-.297-.019-.458.13-.606.134-.133.298-.347.447-.52.15-.174.2-.298.3-.497.1-.199.05-.373-.025-.522-.075-.149-.672-1.618-.92-2.218-.242-.583-.487-.503-.672-.513l-.573-.01c-.199 0-.52.074-.793.373-.273.298-1.04 1.02-1.04 2.48 0 1.459 1.064 2.875 1.213 3.074.149.199 2.095 3.2 5.077 4.487 3 .5 3.9.373 4.23.348.33-.024 1.07-.435 1.22-.86.149-.426.149-.79.105-.86-.045-.07-.168-.11-.365-.198z"
          fill="#fff"
        />
      </svg>
    </a>

    <footer class="site-footer" id="contact">
      <div class="inner">
        <div>
          <strong>O. A. T. Company LTD</strong><br />Adjacent KAWSEC (Nkawkaw
          Senior High School) Junction
        </div>
        <div style="text-align: right">
          <div>
            Call / WhatsApp:
            <a href="tel:+233507969291" style="color: #fff">+233507969291</a>
          </div>
          <div
            style="
              margin-top: 6px;
              font-size: 0.95rem;
              color: rgba(255, 255, 255, 0.9);
            "
          >
            Mon–Sat: 5:00 AM – 7:00 PM | Sun: 5:30 AM – 6:00 PM
          </div>
        </div>
      </div>
    </footer>

    <script>
      /* --- Data model (manual availability toggles) --- */
      const PRODUCTS = [
        {
          id: "butter",
          name: "Butter Bread",
          desc: "Soft, buttery loaf baked fresh daily.",
          img: "/assets/butterbread.jpg",
          prices: [40.0, 30.0, 20.0, 10.0, 3.0],
          available: true,
        },
        {
          id: "sugar",
          name: "Sugar Bread",
          desc: "Sweet and soft — a local favourite.",
          img: "/assets/sugarbread.jpg",
          prices: [20.0, 10.0, 5.0, 2.0],
          available: true,
        },
        {
          id: "wheat",
          name: "Wheat Bread",
          desc: "Wholesome wheat loaf for healthy mornings.",
          img: "/assets/wheatbread.webp",
          prices: [20.0],
          available: true,
          note: "Special orders for different pricing available.",
        },
        {
          id: "biscuits",
          name: "Biscuits (Aberewa Enwe)",
          desc: "Crunchy, sweet biscuits — traditional favourite.",
          img: "/assets/biscuit.jpg",
          prices: [10.0],
          available: true,
        },
      ];

      /* --- Cart storage (local only) --- */
      let CART = JSON.parse(localStorage.getItem("oat_cart_v2") || "[]");
      const r = 0.4; // profit percentage constant for bulk-by-cost and adjustment

      /* --- Helpers --- */
      const formatGH = (v) => "GH₵ " + Number(v).toFixed(2);
      const saveCart = () =>
        localStorage.setItem("oat_cart_v2", JSON.stringify(CART));
      const findProduct = (id) => PRODUCTS.find((p) => p.id === id);

      /* --- Render products into modal --- */
      function renderProducts() {
        const grid = document.getElementById("productsGrid");
        grid.innerHTML = "";
        PRODUCTS.forEach((prod) => {
          const card = document.createElement("article");
          card.className = "card";
          const img = document.createElement("img");
          img.src = prod.img;
          img.alt = prod.name;
          const h = document.createElement("h4");
          h.textContent = prod.name;
          const p = document.createElement("p");
          p.textContent = prod.desc || "";
          const priceRow = document.createElement("div");
          priceRow.className = "price-row";

          prod.prices.forEach((price) => {
            const pill = document.createElement("button");
            pill.className = "price-pill";
            pill.textContent = formatGH(price);
            if (!prod.available) pill.classList.add("disabled");
            pill.onclick = () => onPriceClick(prod.id, price);
            priceRow.appendChild(pill);
          });

          const avail = document.createElement("div");
          avail.className = "availability";
          avail.innerHTML = prod.available
            ? '<span class="badge-available">Available ✅</span>'
            : '<span class="badge-out">Out of stock ❌</span>';

          const actions = document.createElement("div");
          actions.className = "card-actions";
          const orderBtn = document.createElement("a");
          orderBtn.className = "order-btn";
          orderBtn.href = `https://wa.me/233507969291?text=Order:%20${encodeURIComponent(
            prod.name
          )}`;
          orderBtn.textContent = "Order on WhatsApp";
          actions.appendChild(orderBtn);

          card.appendChild(img);
          card.appendChild(h);
          card.appendChild(p);
          card.appendChild(priceRow);
          card.appendChild(avail);
          card.appendChild(actions);
          grid.appendChild(card);
        });
      }

      /* --- Price click handler (adds to cart) --- */
      function onPriceClick(productId, price) {
        const prod = findProduct(productId);
        if (!prod.available) {
          alert("This item is currently out of stock");
          return;
        }
        const mode = document.getElementById("orderMode").value;
        if (mode === "unit") {
          const qtyStr = prompt(
            `Enter quantity for ${prod.name} at ${formatGH(price)}:`,
            "1"
          );
          const qty = Math.max(0, Math.floor(Number(qtyStr) || 0));
          if (qty <= 0) return;
          // For unit orders, we apply adjustment in the cart (buyer pays adjusted cost per unit except biscuits)
          const isBiscuit = prod.id === "biscuits";
          const appliedUnitPrice = isBiscuit
            ? price
            : Number((price / (1 + r)).toFixed(2));
          addToCart({ productId, price, appliedUnitPrice, qty, mode: "unit" });
        } else {
          const cStr = prompt(
            `Enter total GH₵ amount the buyer will pay (Total Cost C):`,
            "100"
          );
          const C = Number(cStr);
          if (!C || C <= 0) return;
          // n = floor((C*(1+r))/S) where S is selling price
          const n = Math.floor((C * (1 + r)) / price);
          if (n <= 0) {
            alert("Amount too small to get any units for this price.");
            return;
          }
          // For bulk-by-cost we record qty = n and store totalCost = C
          addToCart({
            productId,
            price,
            appliedUnitPrice: Number((price / (1 + r)).toFixed(2)),
            qty: n,
            mode: "cost",
            totalCost: Number(C.toFixed(2)),
          });
        }
        renderCart();
        saveCart();
        ensureCartVisible();
      }

      /* --- Add to cart --- */
      function addToCart(item) {
        // item: {productId, price, appliedUnitPrice, qty, mode, totalCost?}
        const key = `${item.productId}__${item.price}__${item.mode}__${
          item.totalCost || 0
        }`;
        const existing = CART.find((c) => c.key === key);
        if (existing) {
          existing.qty += item.qty;
        } else {
          CART.push({
            key,
            productId: item.productId,
            price: item.price,
            appliedUnitPrice: item.appliedUnitPrice,
            qty: item.qty,
            mode: item.mode,
            totalCost: item.totalCost || null,
          });
        }
        saveCart();
      }

      /* --- Render cart --- */
      function renderCart() {
        const list = document.getElementById("cartList");
        list.innerHTML = "";
        let subtotal = 0;
        let count = 0;
        CART.forEach((it, idx) => {
          const prod = findProduct(it.productId);
          const row = document.createElement("div");
          row.className = "cart-item";
          const left = document.createElement("div");
          left.style.flex = "1";
          const title = document.createElement("div");
          title.style.fontWeight = "700";
          title.textContent = prod.name;
          const meta = document.createElement("div");
          meta.style.fontSize = "0.9rem";
          meta.style.color = "var(--muted)";
          if (it.mode === "cost" && it.totalCost) {
            meta.textContent = `${it.qty} pcs (bulk-by-cost, paid ${formatGH(
              it.totalCost
            )})`;
          } else {
            meta.textContent =
              `${it.qty} pcs x market ${formatGH(it.price)}` +
              (prod.id !== "biscuits"
                ? ` · adjusted unit ${formatGH(it.appliedUnitPrice)}`
                : "");
          }
          left.appendChild(title);
          left.appendChild(meta);

          const right = document.createElement("div");
          right.style.textAlign = "right";
          const qtyControls = document.createElement("div");
          qtyControls.className = "qty-controls";
          const minus = document.createElement("button");
          minus.className = "small-btn";
          minus.textContent = "-";
          minus.onclick = () => {
            changeQty(idx, -1);
          };
          const qtyEl = document.createElement("div");
          qtyEl.style.minWidth = "28px";
          qtyEl.style.textAlign = "center";
          qtyEl.textContent = it.qty;
          const plus = document.createElement("button");
          plus.className = "small-btn";
          plus.textContent = "+";
          plus.onclick = () => {
            changeQty(idx, +1);
          };
          qtyControls.appendChild(minus);
          qtyControls.appendChild(qtyEl);
          qtyControls.appendChild(plus);

          const lineTotal = document.createElement("div");
          lineTotal.style.marginTop = "6px";
          let lineAmount = 0;
          if (it.mode === "cost" && it.totalCost) {
            lineAmount = Number(it.totalCost);
          } else {
            // For unit mode, apply adjusted unit price (except biscuits)
            if (prod.id === "biscuits")
              lineAmount = Number((it.price * it.qty).toFixed(2));
            else lineAmount = Number((it.appliedUnitPrice * it.qty).toFixed(2));
          }
          lineTotal.textContent = formatGH(lineAmount);
          right.appendChild(qtyControls);
          right.appendChild(lineTotal);

          const remove = document.createElement("button");
          remove.className = "small-btn";
          remove.textContent = "Remove";
          remove.style.marginLeft = "8px";
          remove.onclick = () => {
            removeItem(idx);
          };
          right.appendChild(remove);

          row.appendChild(left);
          row.appendChild(right);
          list.appendChild(row);

          subtotal += Number(lineAmount);
          count += it.qty;
        });
        document.getElementById("cartSubtotal").textContent =
          formatGH(subtotal);
        document.getElementById("cartCount").textContent = count;
      }

      function changeQty(idx, delta) {
        if (!CART[idx]) return;
        CART[idx].qty = Math.max(0, CART[idx].qty + delta);
        if (CART[idx].qty === 0) CART.splice(idx, 1);
        saveCart();
        renderCart();
        if (CART.length === 0) hideCart();
      }
      function removeItem(idx) {
        CART.splice(idx, 1);
        saveCart();
        renderCart();
        if (CART.length === 0) hideCart();
      }

      /* --- Cart visibility & minimization --- */
      const cartDrawer = document.getElementById("cartDrawer");
      const cartMinBtn = document.getElementById("cartMinBtn");
      function ensureCartVisible() {
        if (CART.length > 0) {
          openCart();
        }
      }
      function openCart() {
        cartDrawer.classList.add("open");
        cartDrawer.setAttribute("aria-hidden", "false");
        cartMinBtn.style.display = "none";
      }
      function hideCart() {
        cartDrawer.classList.remove("open");
        cartDrawer.setAttribute("aria-hidden", "true");
        cartMinBtn.style.display = "none";
      }
      function minimizeCart() {
        cartDrawer.classList.remove("open");
        cartDrawer.setAttribute("aria-hidden", "true");
        cartMinBtn.style.display = "flex";
      }
      function restoreCart() {
        if (CART.length > 0) {
          cartDrawer.classList.add("open");
          cartMinBtn.style.display = "none";
          cartDrawer.setAttribute("aria-hidden", "false");
        }
      }

      document.getElementById("minimizeCart").addEventListener("click", () => {
        minimizeCart();
      });
      cartMinBtn.addEventListener("click", () => {
        restoreCart();
      });
      document.getElementById("clearCart").addEventListener("click", () => {
        if (confirm("Clear cart?")) {
          CART = [];
          saveCart();
          renderCart();
          hideCart();
        }
      });

      /* --- Checkout: prepare WhatsApp message with aggregated cart --- */
      function checkoutToWhatsApp() {
        if (CART.length === 0) {
          alert("Your cart is empty");
          return;
        }
        let lines = [];
        let total = 0;
        CART.forEach((it) => {
          const prod = findProduct(it.productId);
          if (it.mode === "cost" && it.totalCost) {
            lines.push(
              `${prod.name} — ${it.qty} pcs (Bulk pay ${formatGH(
                it.totalCost
              )})`
            );
            total += Number(it.totalCost);
          } else {
            // show adjusted unit pricing (except biscuits uses market price)
            if (prod.id === "biscuits") {
              lines.push(
                `${prod.name} — ${it.qty} pcs x ${formatGH(
                  it.price
                )} = ${formatGH(it.price * it.qty)}`
              );
              total += it.price * it.qty;
            } else {
              lines.push(
                `${prod.name} — ${it.qty} pcs x adjusted ${formatGH(
                  it.appliedUnitPrice
                )} = ${formatGH(
                  it.appliedUnitPrice * it.qty
                )} (market ${formatGH(it.price)})`
              );
              total += it.appliedUnitPrice * it.qty;
            }
          }
        });
        lines.push("---");
        lines.push("Subtotal: " + formatGH(total));
        lines.push("Pickup/Delivery: (specify)");
        lines.push(
          "Payment method: (Mobile Money / Cash on delivery / Card on delivery)"
        );
        const message = encodeURIComponent(lines.join());
        const waUrl = `https://wa.me/233507969291?text=${message}`;
        window.open(waUrl, "_blank");
      }

      /* --- UI wiring --- */
      const menuModal = document.getElementById("menuModal");
      const openMenu = document.getElementById("openMenu");
      const viewMenuBtn = document.getElementById("viewMenuBtn");
      const closeMenu = document.getElementById("closeMenu");
      function showMenu() {
        renderProducts();
        menuModal.style.display = "flex";
        menuModal.classList.add("show");
        menuModal.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
      }
      function hideMenu() {
        menuModal.classList.remove("show");
        menuModal.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "";
        setTimeout(() => (menuModal.style.display = "none"), 320);
      }
      openMenu.addEventListener("click", (e) => {
        e.preventDefault();
        showMenu();
      });
      viewMenuBtn.addEventListener("click", (e) => {
        e.preventDefault();
        showMenu();
      });
      closeMenu.addEventListener("click", hideMenu);
      menuModal.addEventListener("click", (e) => {
        if (e.target === menuModal) hideMenu();
      });
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && menuModal.style.display === "flex")
          hideMenu();
      });
      document
        .getElementById("checkoutBtn")
        .addEventListener("click", checkoutToWhatsApp);

      // render initial state
      renderProducts();
      renderCart();
      if (CART.length > 0) openCart();

      // header scroll behavior + reveal
      const header = document.querySelector(".site-header");
      window.addEventListener("scroll", () => {
        if (window.scrollY > 48) header.classList.add("solid");
        else header.classList.remove("solid");
      });
      window.addEventListener("load", () => {
        setTimeout(() => {
          document
            .querySelectorAll(".reveal")
            .forEach((el) => el.classList.add("visible"));
        }, 180);
      });
    </script>
  </body>
</html>
